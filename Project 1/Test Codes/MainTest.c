#pragma config(Sensor, S1,     CS,             sensorEV3_Color, modeEV3Color_Color)
#pragma config(Sensor, S4,     US,             sensorEV3_Ultrasonic)
#pragma config(Motor,  motorB,          leftWheel,     tmotorEV3_Large, PIDControl, driveLeft, encoder)
#pragma config(Motor,  motorC,          rightWheel,    tmotorEV3_Large, PIDControl, driveRight, encoder)
//*!!Code automatically generated by 'ROBOTC' configuration wizard               !!*//

/*In Virtual Worlds,
left wheel - Port 'B'  and right wheel - Port 'C'.
Sonar sensor - Port '4' and Color Sensor - Port '3'.

Our bot:
left wheel - Port 'A' and right wheel  - Port 'D'.
Sonar sensor - Port '1' and Color Sensor - Port '4'*/

/*Global Variables*/
int wheelSpeed;

/* Function List */
void colourDetect();
void motorControl();
void twoSecBeep();
void stop10();

/* main func */
task main()
{
	while(true){
		stop10();
		colourDetect();
		motorControl();

	}
}

/* Function Def. */
// Colour Detection
void colourDetect(){
	int colourVal;
	while (true){
		colourVal = getColorName(CS); // setup the sensor's name and input jack accordingly

		if(colourVal == 3)
					{
						displayCenteredBigTextLine(1, "%s,%d","green", colourVal);
						// return colourVal;
					}
					else if(colourVal == 2)
					{
						displayCenteredBigTextLine(1, "%s,%d","blue", colourVal);
						// return colourVal;
					}
					else
					{
						displayCenteredBigTextLine(1, "%s,%d","other", colourVal);
						// return colourVal;
					}
		}
}

// Motor Adjustment
void motorControl()
{
	// Reset the encoder to 0
	nMotorEncoder[motorA] = 0;
	nMotorEncoder[motorD] = 0;

	while (true)
	{
		motor[motorA] = 10;
		motor[motorD] = 10;
	}
}

// Beeping for 2 sec
void twoSecBeep()
{
	for (int i = 1; i < 3; i++)
	{
		playSoundFile("Error alarm");
		sleep(1000);
	}
}

// stop 10 cm b4 obstacle
void stop10()
{
	while (true)
	{
		int dist = getUSDistance(US);
		if (dist <= 10)
		{
			wheelSpeed = 0; // stop the bot
			twoSecBeep(); // beeps for 2 sec
			// take next action
			break;
		}
	}
}
